#!/usr/bin/env node

var chalk = require('chalk');
var fetchPage = require('./lib/fetch_page');
var parseBody = require('./lib/parse_body');

function displayResult(keyword, result) {
  if (keyword !== result.word) {
    console.log(chalk.cyan.bold.underline(result.word));
  }
  console.log(result.pronunciation.replace(/\[([^\]]+)\]/g, ': [' + chalk.bold("$1") + ']'));
}

function main() {
  var args = process.argv.splice(2);
  if (args.length === 0) {
    console.error('Usage: ydict-client <word or phrase>');
    process.exit(1);
  }
  var keyword = args.join(' ');

  fetchPage(keyword, function(error, body) {
    if (error) throw new Error(error);
    var result = parseBody(body);
    displayResult(keyword, result);
  });
}

if (require.main === module) {
  main();
}
